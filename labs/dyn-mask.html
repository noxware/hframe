<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <img id="target" src="https://img.freepik.com/premium-photo/beautiful-cute-anime-girl-innocent-anime-teenage_744422-6819.jpg?w=360" width="360" height="360"></img>
  <img id="mask-preload" width="360" height="360"></img>
  <script>
    (async () => {

      let url;


      while (true) {  
        const canvas = new OffscreenCanvas(360, 360);
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = 'black';
        url && URL.revokeObjectURL(url);
        
        if (Math.random() < 0.5) {
          ctx.roundRect(0, 0, 150, 150, 5);
        } else {
          ctx.roundRect(200, 200, 160, 160, 0);
        }

        ctx.fill();

        const blob = await canvas.convertToBlob();
        url = URL.createObjectURL(blob);
        //await new Promise(resolve => setTimeout(resolve, 100));

        const maskPreload = document.getElementById('mask-preload');
        maskPreload.src = url;
        await new Promise(resolve => maskPreload.onload = resolve);

        const img = document.getElementById('target');
        img.style.maskImage = `url(${url})`;
        await new Promise(resolve => setTimeout(resolve, 1000));
      }
    })();
  </script>
</body>
</html>